{{ define "main" }}
    <!-- Blog Post Hero -->
    <section class="relative hero-main">
        <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="blog-hero">                
                <h1>
                    {{ if .Params.h1title }}{{ .Params.h1title }}{{ else }}{{ .Title }}{{ end }}
                </h1>

                <!-- Breadcrumbs -->
                <nav aria-label="Breadcrumb">
                    <div class="text-normal">
                        <a href="/">Home</a>
                        <span class="mx-1" aria-hidden="true">›</span>
                        <a href="/blog/">Blog</a>
                        <span class="mx-1" aria-hidden="true">›</span>
                        <span class="opacity-65">{{ if .Params.h1title }}{{ .Params.h1title }}{{ else }}{{ .Title }}{{ end }}</span>
                    </div>
                </nav>
            </div>
        </div>
    </section>

    {{/* <!-- CTA Section -->
    <section class="pt-12 md:pt-14 bg-white">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="bg-white border-2 border-primary-200 rounded-3xl p-6 md:p-6">
                <div class="text-center">
                    <h3 class="mb-4">
                        Ready to Begin Your Journey?
                    </h3>
                    <p class="text-normal mb-4 max-w-2xl mx-auto">
                        Schedule your personalized consultation and discover how our expertise can help you achieve your aesthetic goals.
                    </p>
                    <div class="flex justify-center">
                        {{ partial "cta-call-button.html" . }}
                    </div>
                </div>
            </div>
        </div>
    </section>*/}}

    <!-- Blog Content -->
    <section class="pt-3 md:pt-6 pb-12 bg-white">
        <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 blog-content-full">
            <div class="max-w-none leading-relaxed blog-content">
                {{ .Content }}
            </div>

            {{ if .Params.categories }}
            <div class="mt-6 text-right">
                <div class="inline-flex items-center gap-2 text-gray-500 bg-gray-50 px-4 py-2 rounded-full">
                    <span>Filed under:</span> 
                    {{ range .Params.categories }}
                    <a href="/categories/{{ . | urlize }}/" 
                       class="text-accent-600 hover:text-accent-700 font-semibold" 
                       aria-label="View all {{ . }} articles">{{ . }}</a>
                    {{ end }}
                </div>
            </div>
            {{ end }}
            
            {{/* Medical Disclaimer - always appears on blog posts */}}
            {{ partial "medical-disclaimer.html" . }}
            
            {{/* FAQ Section - automatically renders if FAQs exist in front matter */}}
            {{ partial "faq-section.html" . }}
            
            {{/* References Section - automatically renders if references exist in front matter */}}
            {{ partial "references-section.html" . }}
            
            {{/* Related Articles Section */}}
            {{ $related := slice }}
            {{ $currentTitle := .Title }}
            
            {{/* First, try to get posts from same categories */}}
            {{ if .Params.categories }}
                {{ $categoryPosts := where .Site.RegularPages "Section" "blog" }}
                {{ $categoryPosts := where $categoryPosts ".Params.categories" "intersect" .Params.categories }}
                {{ $categoryPosts := where $categoryPosts "Title" "!=" $currentTitle }}
                {{ $related = first 3 $categoryPosts }}
            {{ end }}
            
            {{/* If we don't have enough, fill with latest blog posts */}}
            {{ if lt (len $related) 3 }}
                {{ $latestPosts := where .Site.RegularPages "Section" "blog" }}
                {{ $latestPosts := where $latestPosts "Title" "!=" $currentTitle }}
                {{ range $latest := $latestPosts }}
                    {{ $isAlreadyIncluded := false }}
                    {{ range $existing := $related }}
                        {{ if eq $latest.Title $existing.Title }}
                            {{ $isAlreadyIncluded = true }}
                        {{ end }}
                    {{ end }}
                    {{ if not $isAlreadyIncluded }}
                        {{ $related = $related | append $latest }}
                    {{ end }}
                    {{ if eq (len $related) 3 }}
                        {{ break }}
                    {{ end }}
                {{ end }}
            {{ end }}
            
            {{ if $related }}
            <section class="mt-12 pt-8 border-t border-gray-200">
                <h3 class="text-2xl font-semibold text-center mb-8">Related Articles</h3>
                <div class="grid md:grid-cols-3 gap-8">
                    {{ range $related }}
                    <article class="bg-white rounded-xl border-2 border-primary-200 shadow-lg hover:shadow-lg transition-shadow duration-300 overflow-hidden">
                        <div class="p-6 md:p-8">
                            <h4 class="mb-4 leading-tight">
                                <a href="{{ .Permalink }}" class="hover:text-accent-600 transition-colors">
                                    {{ if .Params.h1title }}{{ .Params.h1title }}{{ else }}{{ .Title }}{{ end }}
                                </a>
                            </h4>
                            <p class="leading-tight mb-0">
                                {{ .Description | default .Summary | truncate 100 }}
                            </p>
                        </div>
                    </article>
                    {{ end }}
                </div>
            </section>
            {{ end }}
        </div>
    </section>


    {{ partial "cta-section-large.html" . }}
{{ end }}